# Hello-SVC Deployment (Terraform + Ansible)

A basic Go program that responds to requests with an environment variable templated into the response, deployed to AWS using a modern Infrastructure-as-Code (IaC) and Configuration Management workflow.

## Architecture Documentation

This deployment uses a **Single EC2 Server** hosting both Production and Staging containers as separate Docker processes, proxied via Nginx.

```
┌─────────────────────────────────────────────────────────────────┐
│                         Your Domain                              │
│         ( abu-production.chickenkiller.com with SSL)              │
│         (abu-staging.chickenkiller.com with SSL)                 │
└───────────────────────────┬─────────────────────────────────────┘
                            │
                            │ DNS A Record
                            │
                            ▼
                   ┌───────────────────┐
                   │   EC2 Instance    │
                   │   Elastic IP      │
                   │                   │
                   │  ┌─────────────┐  │
                   │  │   Nginx     │  │
                   │  │ (Reverse    │  │
                   │  │  Proxy)     │  │
                   │  └──────┬──────┘  │
                   │         │         │
                   │    ┌────┴────┐    │
                   │    ▼         ▼    │
                   │ ┌───────┐ ┌───────┐ │
                   │ │ Prod  │ │ Stg   │ │
                   │ │(8080) │ │(8081) │ │
                   │ └───────┘ └───────┘ │
                   └───────────────────┘
```

---

## Project Structure

```
hello-svc-deploy/
├── terraform/          # Infrastructure provisioning
├── ansible/            # Server configuration & deployment
├── hello-svc/          # Application source code
└── README.md
```

---

## Building and Running Locally

### 1. Build and Run Directly
```bash
cd hello-svc
go run main.go
```

### 2. With Docker
```bash
docker build -t hello-svc ./hello-svc
docker run -e "ENV=production" -p 8080:8080 hello-svc
```

---

## Deployment Steps

### Step 1: Terraform Configuration
Run these in the `terraform/` directory to provision the EC2 instance and Elastic IP:
```bash
terraform init
terraform apply
```

### Step 2: Ansible Deployment
Navigate to the `ansible/` directory. Ensure your SSH key is available and subdomains point to the Elastic IP.
```bash
ansible-playbook -i inventory/hosts.ini deploy.yml
```
This playbook installs:
* Docker & Pip
* Certbot (for SSL)
* Nginx (Reverse Proxy)
* Production and Staging containers

---

## Key Design Decisions
* **Single EC2 Instance**: Cost-efficient for small deployments.
* **Elastic IP**: Permanent static IP managed by Terraform.
* **Ansible Roles**: Modular configuration for `common`, `app`, `nginx`, and `certbot`.
* **Nginx Reverse Proxy**: Directs traffic based on hostname to the correct container.
